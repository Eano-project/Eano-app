<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 🌐 SEO Meta -->
  <meta name="description" content="EANO – Secure Digital Mining App, Earn Rewards Daily Like Pi Network">
  <meta name="keywords" content="EANO, mining, crypto, Pi Network, rewards, secure, earn, digital currency">
  <meta name="author" content="Santus EANO Team">
  <meta name="theme-color" content="#111827" />
  <title>EANO – Mine & Earn</title>

  <!-- 📱 PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="icon" type="image/png" href="icons/icon-192.png" />

  <!-- 🧠 Open Graph Meta -->
  <meta property="og:title" content="EANO – Mine & Earn" />
  <meta property="og:description" content="Start mining EANO like Pi Network. Secure, clean, and rewarding!" />
  <meta property="og:image" content="icons/icon-512.png" />
  <meta property="og:url" content="https://eano-santus.github.io/eano-coin/" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- 📦 External Styles -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="container">
    <section id="welcome-section" style="display:none;">
      <h1>Welcome back to EANO 🚀</h1>
      <p>Redirecting to your dashboard...</p>
    </section>

    <section id="login-section">
      <h1>EANO Network</h1>
      <p>Start Mining with Trust</p>

      <!-- 🌍 Language Selector -->
      <select id="langSelect">
        <option value="en">🌐 English</option>
        <option value="ig">🗣 Igbo</option>
        <option value="ha">🗣 Hausa</option>
        <option value="yo">🗣 Yoruba</option>
      </select>

      <!-- 🔐 Google Sign-In -->
      <button id="googleSignInBtn" class="google-btn">Sign in with Google</button>

      <!-- 🔄 Redirect Note -->
      <p id="redirectNote" style="display:none;">Completing setup...</p>
    </section>
  </main>

  <!-- 🧠 Firebase Setup -->
  <script type="module">
    import { auth, db } from './firebase.js';
    import { signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const signInBtn = document.getElementById('googleSignInBtn');
    const loginSection = document.getElementById('login-section');
    const welcomeSection = document.getElementById('welcome-section');
    const redirectNote = document.getElementById('redirectNote');

    const provider = new GoogleAuthProvider();
    const refCode = new URLSearchParams(window.location.search).get('ref') || null;

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const userRef = doc(db, "users", user.uid);
        const userSnap = await getDoc(userRef);

        if (userSnap.exists()) {
          const data = userSnap.data();
          const isVerified = data.firstname && data.lastname && data.username && data.email && data.referralCode;

          if (!isVerified) {
            window.location.href = 'setup.html';
          } else {
            loginSection.style.display = 'none';
            welcomeSection.style.display = 'block';
            setTimeout(() => window.location.href = 'dashboard.html', 1500);
          }
        } else {
          await setDoc(userRef, {
            email: user.email,
            uid: user.uid,
            referralCode: refCode || "none",
            createdAt: Date.now()
          });
          window.location.href = 'setup.html';
        }
      }
    });

    signInBtn.addEventListener('click', async () => {
      redirectNote.style.display = 'block';
      try {
        await signInWithPopup(auth, provider);
      } catch (error) {
        console.error("Google Sign-In failed:", error);
        redirectNote.textContent = "Something went wrong. Try again.";
      }
    });
  </script>

  <!-- 📲 Register Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }
  </script>
</body>
</html>
