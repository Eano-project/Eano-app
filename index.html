<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ğŸŒ SEO Meta -->
  <meta name="description" content="EANO â€“ Secure Digital Mining App, Earn Rewards Daily Like Pi Network">
  <meta name="keywords" content="EANO, mining, crypto, Pi Network, rewards, secure, earn, digital currency">
  <meta name="author" content="Santus EANO Team">
  <meta name="theme-color" content="#111827" />
  <title>EANO â€“ Mine & Earn</title>

  <!-- ğŸ“± PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="icon" type="image/png" href="icons/icon-192.png" />

  <!-- ğŸ§  Open Graph Meta -->
  <meta property="og:title" content="EANO â€“ Mine & Earn" />
  <meta property="og:description" content="Start mining EANO like Pi Network. Secure, clean, and rewarding!" />
  <meta property="og:image" content="icons/icon-512.png" />
  <meta property="og:url" content="https://eano-santus.github.io/eano-coin/" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- âœ¨ Styles -->
  <link rel="stylesheet" href="style.css" />
</head>

<body class="dark">
  <main class="centered-box">
    <img src="icons/icon-192.png" alt="EANO Logo" class="app-logo" />

    <h1 class="glow-text">Welcome to EANO</h1>
    <p>Secure Mining. Real Value.</p>

    <!-- ğŸŒ Language Selector -->
    <select id="langSelect" class="lang-select">
      <option value="en">ğŸŒ English</option>
      <option value="ig">ğŸ—£ Igbo</option>
      <option value="ha">ğŸ—£ Hausa</option>
      <option value="yo">ğŸ—£ Yoruba</option>
    </select>

    <!-- ğŸ” Google Sign-In -->
    <button id="googleSignInBtn" class="google-btn">ğŸ” Sign in with Google</button>

    <!-- ğŸ‘‹ Redirect Messages -->
    <p id="statusMsg" class="status-msg" style="display:none;">Please wait...</p>
  </main>

  <!-- ğŸ“¦ Firebase & Auth -->
  <script type="module">
    import { auth, db } from './firebase.js';
    import { signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const signInBtn = document.getElementById('googleSignInBtn');
    const statusMsg = document.getElementById('statusMsg');
    const refCode = new URLSearchParams(window.location.search).get('ref') || null;

    const provider = new GoogleAuthProvider();

    // ğŸ” Existing login check
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const userRef = doc(db, "users", user.uid);
        const snap = await getDoc(userRef);

        if (snap.exists()) {
          const data = snap.data();
          const complete = data.firstname && data.lastname && data.username && data.email;

          if (!complete) {
            window.location.href = 'setup.html';
          } else {
            statusMsg.style.display = 'block';
            statusMsg.innerText = "Welcome back! Redirecting...";
            setTimeout(() => window.location.href = 'dashboard.html', 1500);
          }
        } else {
          // Create new user shell
          await setDoc(userRef, {
            uid: user.uid,
            email: user.email,
            referralCode: refCode || "none",
            createdAt: Date.now()
          });
          window.location.href = 'setup.html';
        }
      }
    });

    // ğŸ” Google Sign-in handler
    signInBtn.addEventListener('click', async () => {
      statusMsg.style.display = 'block';
      statusMsg.innerText = "Signing in...";
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        console.error("Sign-in failed", err);
        statusMsg.innerText = "Failed to sign in. Try again.";
      }
    });
  </script>

  <!-- âš™ï¸ Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }
  </script>
</body>
</html>
